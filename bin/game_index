#!/bin/sh

# Initialize arrays to store game entries
active_games=""
wanted_games=""
completed_games=""

for dir in src/games/*; do
  [ ! -d "$dir" ] && continue

  md_file="${dir}/index.md"
  [ ! -f "$md_file" ] && continue

  # Extract game information from each index.md file
  title=$(grep -m 1 '^title:' "$md_file" | sed 's/title: //')
  state=$(grep -m 1 '^state:' "$md_file" | sed 's/state: //')

  # Create a hyperlink entry for the game
  link="- [$title](/games/$(basename "$dir"))"

  # Categorize the game based on its state
  case "$state" in
    active)
      active_games=$(printf "%s\n%s" "$active_games" "$link")
      ;;
    wanted)
      wanted_games=$(printf "%s\n%s" "$wanted_games" "$link")
      ;;
    completed)
      completed_games=$(printf "%s\n%s" "$active_games" "$link")
      ;;
    *)
      # Default case: categorize as wanted if state is not specified
      wanted_games=$(printf "%s\n%s" "$wanted_games" "$link")
      ;;
  esac
done

# Create or overwrite the index.md file
cat <<EOF >src/games/index.md
---
title-prefix: Games
---

## Playing
$(printf "%s" "$active_games")

## Wanted
$(printf "%s" "$wanted_games")

## Completed
$(printf "%s" "$completed_games")
EOF

echo "index.md file generated successfully."
