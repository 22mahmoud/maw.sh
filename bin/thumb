#!/bin/sh -e

dir="$1"
images="$dir/*.jpg"
thumbs="$dir/thumbs"

for i in $images; do
  image_name=$(basename -s .jpg "$i")

  # only convert the image if the thumbs not exist
  if [ ! -f "$thumbs/${image_name}.webp" ]; then
    convert -quality 50 -define webp:extent=50kb "$i" -thumbnail 350x350^ \
      -gravity center -extent 350x350 "$thumbs/${image_name}.webp"
  fi
done
