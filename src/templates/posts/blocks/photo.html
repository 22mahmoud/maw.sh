{% load base_tags wagtailimages_tags wagtailcore_tags %}

<div class="flex flex-col gap-4">
  <div class="grid grid-cols-2 gap-4 lg:grid-cols-3">
    {% for image in value.images %}
      {% if layout == 'preview' or layout == 'compact' %}
        <div class="group relative aspect-square overflow-hidden border border-primary/10 shadow-sm transition-all duration-300 hover:shadow-xl">
          {% picture image format-{avif,webp,jpeg} width-200 alt=image.title class="u-photo h-full w-full object-cover transition-transform duration-300 group-hover:scale-105" %}
        </div>
      {% else %}
        {% image image original as full %}
        <a href="{{ full.full_url }}"
           target="_blank"
           rel="noopener noreferrer"
           class="group relative aspect-square cursor-pointer overflow-hidden border border-primary/10 shadow-sm transition-all duration-300 hover:shadow-xl">
          {% picture image format-{avif,webp,jpeg} width-400 alt=image.title class="u-photo h-full w-full object-cover transition-transform duration-300 group-hover:scale-105" %}
        </a>
      {% endif %}
    {% endfor %}
  </div>

  {% if layout == 'compact' %}
    <span hidden class="p-location"> {{ value.location }} </span>
  {% endif %}

  {% if layout != 'compact' %}
    {% if value.caption %}
      <div class="e-content prose prose-main max-w-none pt-2">
        {{ value.caption | richtext }}
      </div>
    {% endif %}

    <div class="mt-4 flex flex-col gap-3 text-sm text-secondary">
      {% if value.taken_date %}
        <time class="dt-photo flex items-center gap-2">
          <span class="inline-flex items-center gap-2">
            {% icon "camera" class="h-4 w-4 text-accent sm:h-5 sm:w-5" %}
            <span>
              Taken on {{ value.taken_date|date:"F j, Y" }}
            </span>
          </span>
        </time>
      {% endif %}

      {% if value.location %}
        <div class="p-location flex items-center gap-2">
          {% icon "map-pin" class="h-4 w-4 text-accent sm:h-5 sm:w-5" %}
          <span>
            {{ value.location }}
          </span>
        </div>
      {% endif %}
    </div>
  {% endif %}
</div>
