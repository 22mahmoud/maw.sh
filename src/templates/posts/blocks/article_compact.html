{% load base_tags %}
{% load wagtailimages_tags wagtailcore_tags %}

<article class="h-entry flex flex-col group bg-darker shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-[2px] min-h-48 md:min-h-64">
  {% if post.get_tags %}
    <ul hidden>
      {% for tag in post.get_tags %}
        <li>
          <a href="{{ tag.url }}" class="p-category">#{{ tag }}</a>
        </li>
      {% endfor %}
    </ul>
  {% endif %}

  <a class="u-url flex-1 flex flex-col justify-between h-full p-4 md:p-6 hover:bg-neutral-800/50 transition-colors duration-300"
     href="{{ post.url }}">

    {% if post.get_tags %}
      <div class="flex flex-wrap gap-2 mb-3">
        {% for tag in post.get_tags|slice:":2" %}
          <span class="rounded-full inline-block border border-primary/30 bg-primary/5 px-2.5 py-0.5 text-xs font-medium text-primary transition-colors duration-200">
            #{{ tag }}
          </span>
        {% endfor %}
        {% if post.get_tags|length > 2 %}
          <span class="rounded-full inline-block border border-secondary/30 bg-secondary/5 px-2.5 py-0.5 text-xs font-medium text-secondary">
            +{{ post.get_tags|length|add:"-2" }}
          </span>
        {% endif %}
      </div>
    {% endif %}

    <h3 class="p-name font-heading text-xl md:text-2xl font-bold text-primary group-hover:text-accent line-clamp-2 overflow-hidden transition-colors duration-300 mb-3">
      {{ post.title }}
    </h3>

    {% if post.summary %}
      <p class="text-sm text-secondary line-clamp-3 mb-4 group-hover:text-primary transition-colors duration-300">
        {{ post.summary|truncatewords:20 }}
      </p>
    {% endif %}

    <div class="flex items-center justify-between mt-auto pt-3 border-t border-neutral-800">
      {% if post.authors %}
        <div class="flex items-center gap-2">
          {% with author=post.authors.0 %}
            {% if author.image %}
              {% picture author.image format-{avif,webp,jpeg} width-32 height-32 alt=author.full_name class="w-6 h-6 rounded-full md:w-8 md:h-8 object-cover" %}
            {% endif %}
            <span class="text-xs md:text-sm font-medium text-secondary group-hover:text-accent transition-colors duration-300 truncate">
              {{ author.full_name }}
            </span>
          {% endwith %}
        </div>
      {% endif %}

      <time class="dt-published text-xs md:text-sm text-secondary flex gap-1 items-center group-hover:text-accent transition-colors duration-300 flex-shrink-0"
            datetime="{{ post.first_published_at|date:'c' }}">
        {% icon "calendar-blank" class="w-3 h-3 md:w-4 md:h-4 text-secondary group-hover:text-accent transition-colors duration-300" %}
        <span class="hidden sm:inline">{{ post.first_published_at|date:"F j, Y" }}</span>
        <span class="sm:hidden">{{ post.first_published_at|date:"M j" }}</span>
      </time>
    </div>
  </a>
</article>
