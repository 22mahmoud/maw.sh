{% load wagtailimages_tags wagtailroutablepage_tags wagtailcore_tags %}

<div class="flex flex-col gap-2">
  <div class="prose prose-main prose-sm max-w-none leading-snug">
    <p class="p-summary
              {% if value.content_data.is_truncated %}
                line-clamp-3
              {% endif %}">
      {{ value.content_data.truncated|richtext|striptags }}
      {% if value.content_data.is_truncated %}
        <a class="ml-1 inline-block text-accent underline transition hover:no-underline focus:outline-none focus:ring-1 focus:ring-accent focus:ring-offset-1"
           href="{% pageurl post %}">
          more
        </a>
      {% endif %}
    </p>
  </div>

  {% if value.media %}
    <div class="grid grid-cols-2 gap-1.5">
      {% for block in value.media|slice:":2" %}
        <div class="group relative aspect-square overflow-hidden border border-primary/10 shadow-sm">
          {% if block.block_type == 'image' %}
            {% picture block.value format-{avif,webp,jpeg} width-300 class="u-photo h-full w-full object-cover transition-transform duration-300 group-hover:scale-105" %}
          {% elif block.block_type == 'video' %}
            <div class="u-video h-full w-full *:h-full *:w-full *:object-cover">
              {{ block }}
            </div>
          {% elif block.block_type == 'video_embed' %}
            <div class="u-video h-full w-full *:h-full *:w-full *:object-cover">
              {{ block }}
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>
