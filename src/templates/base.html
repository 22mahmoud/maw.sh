{% load partials base_tags partials django_vite wagtailuserbar static seo_tags %}
{% load wagtail_cache %}

<!DOCTYPE html>
<html lang="en" class="h-full scroll-smooth no-js">
  {% if not request.htmx %}
    <head>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="dns-prefetch" href="//static.mahmoudashraf.dev">
      <link rel="preconnect" href="https://static.mahmoudashraf.dev" crossorigin>
      <link rel="preload" as="image" href="{% static 'icons/fill.png' %}">
      <link rel="preload"
            href="{% static 'fonts/outfit-v14-latin-700.woff2' %}"
            as="font"
            type="font/woff2"
            crossorigin>
      <link rel="preload"
            href="{% static 'fonts/figtree-v8-latin-regular.woff2' %}"
            as="font"
            type="font/woff2"
            crossorigin>
      <link rel="preload"
            href="{% static 'fonts/figtree-v8-latin-600.woff2' %}"
            as="font"
            type="font/woff2"
            crossorigin>
      <meta charset="utf-8">
      <meta name="htmx-config"
            content='{"inlineStyleNonce": "{{ CSP_NONCE }}", "inlineScriptNonce":"{{ CSP_NONCE }}","includeIndicatorStyles":false, "allowEval": false}'>
      <style>
        @font-face {
          font-display: swap;
          font-family: "DepartureMono";
          src: url("{% static 'fonts/DepartureMono-Regular.woff2' %}") format("woff2");
          font-weight: normal;
          font-style: normal;
        }

        @font-face {
          font-display: swap;
          font-family: "Outfit";
          font-style: normal;
          font-weight: 400;
          src: url("{% static 'fonts/outfit-v14-latin-regular.woff2' %}") format("woff2");
        }

        @font-face {
          font-display: swap;
          font-family: "Outfit";
          font-style: normal;
          font-weight: 700;
          src: url("{% static 'fonts/outfit-v14-latin-700.woff2' %}") format("woff2");
        }

        @font-face {
          font-display: swap;
          font-family: "Figtree";
          font-style: normal;
          font-weight: 400;
          src: url("{% static 'fonts/figtree-v8-latin-regular.woff2' %}") format("woff2");
        }

        @font-face {
          font-display: swap;
          font-family: "Figtree";
          font-style: normal;
          font-weight: 700;
          src: url("{% static 'fonts/figtree-v8-latin-700.woff2' %}") format("woff2");
        }

        @font-face {
          font-display: swap;
          font-family: "Figtree";
          font-style: italic;
          font-weight: 500;
          src: url("{% static 'fonts/figtree-v8-latin-500italic.woff2' %}") format("woff2");
        }

        @font-face {
          font-display: swap;
          font-family: "Figtree";
          font-style: normal;
          font-weight: 500;
          src: url("{% static 'fonts/figtree-v8-latin-500.woff2' %}") format("woff2");
        }

        @font-face {
          font-display: swap;
          font-family: "Figtree";
          font-style: normal;
          font-weight: 600;
          src: url("{% static 'fonts/figtree-v8-latin-600.woff2' %}") format("woff2");
        }
      </style>

      <title>
        {% block title %}
          {% wagtailpagecache 500 head_title %}
            {% seo_full_title page %}
          {% endwagtailpagecache %}
        {% endblock title %}
      </title>

      <script nonce="{{ CSP_NONCE }}">
        document.documentElement.classList.remove('no-js');
      </script>
      <style nonce="{{ CSP_NONCE }}">
      [x-cloak] { display: none !important; }

      .no-js .js-only {
        display: none;
      }

     .js-only {
        visibility: visible;
      }
      </style>
      <meta name="description"
            content="{% block description %}
                       {% seo_meta_description page %}
                     {% endblock description %}">

      <meta name="keywords" content="this,is,a,keywords">

      <link rel="icon"
            type="image/png"
            href="{% static "favicon-96x96.png" %}"
            sizes="96x96" />
      <link rel="icon" type="image/svg+xml" href="{% static "favicon.svg" %}" />
      <link rel="shortcut icon" href="{% static "favicon.ico" %}" />
      <link rel="apple-touch-icon"
            sizes="180x180"
            href="{% static "apple-touch-icon.png" %}" />
      <meta name="apple-mobile-web-app-title" content="Mahmoud Ashraf" />
      <link rel="manifest" href="{% static "site.webmanifest" %}" />

      <link rel="canonical" href="{{ page.seo_canonical_url }}" />
      {% if next_url %}
        <link rel="next" href="{{ next_url }}" />
      {% endif %}
      {% if prev_url %}
        <link rel="prev" href="{{ prev_url }}" />
      {% endif %}

      {% block head %}
      {% endblock head %}

      {% vite_hmr_client %}
      {% vite_asset 'src/resources/js/app.ts' nonce=CSP_NONCE %}

    </head>
  {% endif %}

  <body hx-headers='{"x-csrftoken": "{{ csrf_token }}"}'
        class="relative h-full bg-darker text-primary">

    <aside class="fixed left-4 bottom-4 max-w-xs z-10 bg-darker">
      {% block aside %}
      {% endblock aside %}
    </aside>

    <div class="min-h-full flex flex-col max-w-6xl mx-auto">
      {% if not request.htmx %}
        {% wagtailuserbar %}

        <a id="top"></a>
      {% endif %}

      {% partialdef messages inline %}
        <div id="messages"
             hx-swap-oob="beforeend"
             class="fixed bottom-20 right-4 sm:right-8 z-50 w-[calc(100%-2rem)] sm:w-96 max-w-full space-y-3 pointer-events-none sm:pointer-events-auto px-2 sm:px-0">
          <div class="relative space-y-3">
            {% for message in messages %}
              <div x-data="messages"
                   data-counter="{{ forloop.counter0 }}"
                   @mouseenter="stop"
                   @mouseleave="play"
                   x-show="opened"
                   x-transition:enter="transition ease-out duration-500 transform"
                   x-transition:enter-start="translate-x-4 opacity-0"
                   x-transition:enter-end="translate-x-0 opacity-100"
                   x-transition:leave="transition ease-in duration-300 transform"
                   x-transition:leave-start="translate-x-0 opacity-100"
                   x-transition:leave-end="translate-x-4 opacity-0"
                   class="pointer-events-auto flex items-start justify-between gap-4 px-4 py-3 sm:px-5 sm:py-4 shadow-xl text-sm sm:text-base font-semibold border-l-4 bg-darker border border-dark {{ message.tags|message_color }}">
                <div class="flex-1 break-words">
                  {{ message }}
                </div>

                <button @click="close"
                        class="js-only shrink-0 cursor-pointer text-xl leading-none text-secondary hover:text-primary focus:outline-none focus-visible:ring">
                  {% icon "x" class="w-4 h-4" %}
                </button>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endpartialdef %}

      {% if not request.htmx %}
        {% include "includes/header.html" %}
      {% endif %}

      <main class="bg-darker flex-1 flex flex-col relative z-1">
        {% block content %}
        {% endblock content %}
      </main>

      {% if not request.htmx %}
        {% include "includes/footer.html" %}

        <script defer
                data-api="/api/p/event"
                data-domain="mahmoudashraf.dev"
                src="/js/p/script.js"></script>

        {% if False and not request.user.is_authenticated %}
          <script nonce="{{ CSP_NONCE }}" src="//accounts.google.com/gsi/client" async></script>
          {# djlint:off #}
          <div
            id="g_id_onload"
            data-client_id="269809974094-1mjt6e4clvjjbg06884vjv8k59t8qa6a.apps.googleusercontent.com"
            data-login_uri="{% url 'google_login_by_token' %}">
          {# djlint:on #}
        </div>
      {% endif %}
    {% endif %}
  </div>
</body>
</html>
