{% load base_tags field_tags button_tags menu_tags %}
{% load wagtail_cache wagtailcore_tags %}

<header x-data="headerNav"
        class="sticky z-50 top-0 shadow bg-gradient-to-r from-gradient-1 to-gradient-2 font-bold pb-[2px] transition-shadow duration-300">

  <div class="w-full bg-dark">
    <div class="max-w-screen-xl mx-auto px-4 py-3 flex flex-wrap items-center justify-between gap-4">
      <a href="{% slugurl 'home' %}"
         class="text-2xl font-heading font-bold group"
         aria-label="Homepage">
        <span class="text-primary">
          ~/mahmoud<span class="relative -bottom-0.5 group-hover:animate-blink">_</span>ashraf
        </span>
      </a>

      <button id="mobile-menu-toggle"
              @click="toggle"
              x-cloak
              class="sm:hidden inline-flex items-center justify-center p-3 w-12 h-12 rounded-mdtext-primary hover:text-white focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white"
              :aria-expanded="openStr"
              aria-controls="mobile-menu"
              aria-label="Toggle navigation menu">
        {% icon "hamburger" x_show="closed" class="h-6 w-6" aria_hidden="true" %}
        {% icon "x" x_show="opened" class="h-6 w-6" aria_hidden="true" %}
      </button>

      <div class="hidden sm:flex items-center gap-4" x-clock>
        {% include "includes/search_form.html" with type="desktop" %}

        <nav>
          <ul class="flex flex-wrap items-center justify-end gap-x-6 gap-y-2 text-base sm:text-lg">
            {% wagtailcache 315360000 main_menu user.is_authenticated %}
              {% main_menu template="includes/main_menu.html" %}
            {% endwagtailcache %}
          </ul>
        </nav>
      </div>
    </div>
  </div>

  <noscript>
    <style nonce="{{ CSP_NONCE }}">
      #mobile-menu-toggle {
        display: none !important;
      }

      @media (max-width: 639px) {
        #mobile-menu {
          display: block !important;
        }
        #mobile-menu > div {
          padding: 1rem;
        }
        #mobile-menu ul {
          display: flex !important;
          align-items: center !important;
          flex-direction: row !important;
          flex-wrap: wrap !important;
          gap: 1.5rem;
          padding: .5rem;
          font-size: 1rem;
        }
        #mobile-menu form {
          margin-bottom: 1rem;
        }
      }

      @media (min-width: 640px) {
        #mobile-menu {
          display: none !important;
        }
        .sm\:flex {
          display: flex !important;
        }
        .sm\:hidden {
          display: none !important;
        }
      }
    </style>
  </noscript>

  <div x-collapse
       x-cloak
       x-show="opened"
       @click.outside="close"
       @keydown.escape.window="close"
       class="sm:hidden bg-dark overflow-hidden transition-all duration-300 ease-in-out"
       id="mobile-menu">
    <div class="px-4 pt-4 pb-6">
      {% include "includes/search_form.html" with type="mobile" %}

      <nav>
        <ul class="flex flex-col gap-2 text-base">
          {% wagtailcache 315360000 main_menu user.is_authenticated %}
            {% main_menu template="includes/main_menu.html" %}
          {% endwagtailcache %}
        </ul>
      </nav>
    </div>
  </div>
</header>
