{% load base_tags field_tags button_tags menu_tags %}
{% load wagtailcore_tags %}

<header x-data="{ open: false }"
        class="sticky z-50 top-0 shadow bg-gradient-to-r from-gradient-1 to-gradient-2 font-bold pb-[2px]">
  <div class="h-full w-full bg-dark px-4 py-3 flex flex-wrap items-center justify-between gap-4">
    <a href="{% slugurl 'home' %}"
       class="text-2xl font-heading font-bold group"
       aria-label="Homepage">
      <span class="text-primary">
        ~/mahmoud<span class="relative -bottom-0.5 group-hover:animate-blink">_</span>ashraf
      </span>
    </a>

    <button id="mobile-menu-toggle"
            @click="open = !open"
            x-cloak
            class="sm:hidden inline-flex items-center justify-center p-3 rounded-md text-primary hover:text-white focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white"
            :aria-expanded="open.toString()"
            aria-controls="mobile-menu"
            aria-label="Toggle navigation menu">
      {% icon "hamburger" x_show="!open" class="h-6 w-6" aria_hidden="true" %}
      {% icon "x" x_show="open" class="h-6 w-6" aria_hidden="true" %}
    </button>

    <div class="hidden sm:flex items-center gap-4" x-clock>
      {% include "includes/search_form.html" with type="desktop" %}

      <nav>
        <ul class="flex flex-wrap justify-start sm:justify-end gap-4 text-base sm:text-lg">
          {% main_menu template="includes/main_menu.html" %}
        </ul>
      </nav>
    </div>
  </div>

  <noscript>
    <style>
    #mobile-menu-toggle {
      display: none !important;
    }

    @media (max-width: 639px) {
      #mobile-menu {
        display: block !important;
      }
      #mobile-menu > div {
        padding: 1rem;
      }
      #mobile-menu ul {
        display: flex !important;
        flex-direction: row !important;
        gap: 0.5rem;
        font-size: 1rem;
      }
      #mobile-menu form {
        margin-bottom: 1rem;
      }
    }

    @media (min-width: 640px) {
      #mobile-menu {
        display: none !important;
      }
      .sm\:flex {
        display: flex !important;
      }
      .sm\:hidden {
        display: none !important;
      }
    }
    </style>
  </noscript>

  <div x-collapse
       x-cloak
       x-show="open"
       @click.outside="open = false"
       @keydown.escape.window="open = false"
       class="sm:hidden bg-dark overflow-hidden transition-all duration-300 ease-in-out"
       id="mobile-menu">
    <div class="px-4 pt-4 pb-6">
      {% include "includes/search_form.html" with type="mobile" %}

      <nav>
        <ul class="flex flex-col gap-2 text-base">
          {% main_menu template="includes/main_menu.html" %}
        </ul>
      </nav>
    </div>
  </div>
</header>
