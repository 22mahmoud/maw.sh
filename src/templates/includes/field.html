{% load base_tags %}

{% if tag_type == 'checkbox' %}
  <div class="flex items-center gap-2 {{ wrapper_class }}"
       {{ wrapper_attrs }}>
    <input type="checkbox" {{ field_attrs }}>

    {% if label %}
      <label for="{{ id }}" class="{{ label_class }}">
        {{ label }}
      </label>
    {% endif %}
  </div>
{% elif tag_type == 'radio' %}
  <div class="flex-1 flex flex-col gap-1.5 {{ wrapper_class }}"
       {{ wrapper_attrs }}>
    {% if label %}
      <div class="{{ label_class }}">
        {{ label }}
      </div>
    {% endif %}

    <div class="flex flex-col gap-2">
      {{ content|safe }}
    </div>

    <div id="{{ id }}-error"
         class="text-sm text-red-400 mt-1
                {% if not errors %}
                  sr-only
                {% endif %}"
         role="alert">
      {{ errors }}
    </div>
  </div>
{% else %}
  <div {% if not type == 'hidden' %}
         class="flex-1 flex flex-col gap-1.5  {{ wrapper_class }}"
       {% endif %}
       {{ wrapper_attrs }}>
    {% if label and not type == 'hidden' %}
      <label for="{{ id }}" class="{{ label_class }}">
        {{ label }}
      </label>
    {% endif %}

    {% if help_text %}
      <div id="{{ id }}-help"
           class="prose prose-sm prose-main text-sm text-secondary">
        {{ help_text }}
      </div>
    {% endif %}

    {% if tag_type == 'select' %}
      <select {{ field_attrs }}>
        {{ content|safe }}
      </select>
    {% elif tag_type == "textarea" %}
      <textarea {{ field_attrs }}>{{ value }}</textarea>
    {% else %}
      {% if type == "password" %}
        <div x-data="passwordField" class="relative">
          <input :type="inputType" {{ field_attrs }} class="pr-12">
          <button type="button"
                  @click="toggle"
                  :aria-label="toggleLabel"
                  class="js-only absolute inset-y-0 right-0 flex items-center px-3 text-secondary transition-colors duration-200 hover:text-primary focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/50">
            <span x-show="isHidden" x-cloak>
              {% icon "eye" class="w-5 h-5" %}
            </span>
            <span x-show="isVisible" x-cloak>
              {% icon "eye-slash" class="w-5 h-5" %}
            </span>
          </button>
        </div>
      {% elif type == "file" %}
        <div x-data="fileInputField" class="flex flex-col gap-2">
          <input @change="updateFileName" {{ field_attrs }}>

          <p x-show="fileName" class="text-sm text-secondary mt-1">
            Selected: <span class="font-medium" x-text="fileName"></span>
          </p>

          {% if file_name %}
            <p class="text-sm text-secondary mt-1">
              Current:
              {% if file_url %}
                <a href="{{ file_url }}" class="underline hover:text-accent transition">{{ file_name }}</a>
              {% else %}
                {{ file_name }}
              {% endif %}
            </p>

            <label for="{{ id }}-clear" class="flex items-center gap-2 text-sm mt-1">
              <input type="checkbox"
                     name="{{ name }}-clear"
                     id="{{ id }}-clear"
                     class="accent-red-500 border border-neutral-700 w-4 h-4">
              Remove current file
            </label>
          {% endif %}
        </div>
      {% else %}
        <input {{ field_attrs }}>
      {% endif %}
    {% endif %}

    <div id="{{ id }}-error"
         class="text-sm text-red-400 mt-1
                {% if not errors %}
                  sr-only
                {% endif %}"
         role="alert">
      {{ errors }}
    </div>
  </div>
{% endif %}
