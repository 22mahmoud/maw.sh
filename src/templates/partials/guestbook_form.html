{% load field_tags partials %}

<form id="guestbook-form"
      method="post"
      action="{% url 'guestbook' %}"
      hx-post="{% url 'guestbook' %}"
      hx-target="#guestbook-form"
      hx-swap="outerHTML">
  <div class="space-y-4">
    <noscript>
      {% csrf_token %}
      <input type="hidden" name="page_id" value="{{ page.id }}">
      <input type="hidden" name="source_url_fragment" value="#guestbook-form">
    </noscript>

    <div class="grid grid-cols-3 gap-4 items-stretch">
      {% partialdef name inline %}
        <div id="name-wrapper"
             class="col-span-2"
             hx-post="{% url "validate_guestbook_field" %}"
             hx-trigger="input changed delay:500ms, blur from:#name"
             hx-target="#name-wrapper"
             hx-sync="closest form:abort">
          {% field
            required=""
            name="name"
            label="Name"
            value=form.name.value
            error=form.name.errors
            error_message=form.name.errors.as_text
            x-model="form.name" %}
          {% endfield %}
        </div>
      {% endpartialdef %}

      {% partialdef emoji inline %}
        <div id="emoji-wrapper"
             class="h-full"
             hx-post="{% url "validate_guestbook_field" %}"
             hx-trigger="input changed delay:500ms, blur from:#emoji"
             hx-target="#emoji-wrapper"
             hx-sync="closest form:abort">
          {% field
            required=""
            name="emoji"
            label="Emoji"
            maxlength=2
            value=form.emoji.value
            error=form.emoji.errors
            error_message=form.emoji.errors.as_text
            x-model="form.emoji" %}
          {% endfield %}
        </div>
      {% endpartialdef %}
    </div>

    {% partialdef message inline %}
      <div id="message-wrapper"
           hx-post="{% url "validate_guestbook_field" %}"
           hx-trigger="input changed delay:500ms, blur from:#message"
           hx-target="#message-wrapper"
           hx-sync="closest form:abort"
           class="w-full">
        {% field
          required=""
          name="message"
          label="Message"
          as="textarea"
          rows=4
          value=form.message.value
          error=form.message.errors
          error_message=form.message.errors.as_text
          help_text="Supports basic Markdown and HTML. Max 280 characters. GIFs allowed from giphy/tenor/imgur."
          x-model="form.message" %}
        {% endfield %}
      </div>
    {% endpartialdef %}

    {% partialdef url inline %}
      <div id="url-wrapper"
           hx-post="{% url "validate_guestbook_field" %}"
           hx-trigger="input changed delay:500ms, blur from:#url"
           hx-target="#url-wrapper"
           hx-sync="closest form:abort"
           class="max-w-sm">
        {% field
          name="url"
          label="Website (optional)"
          x-model="form.url"
          value=form.url.value
          error=form.url.errors
          error_message=form.url.errors.as_text %}
        {% endfield %}
      </div>
    {% endpartialdef %}

    {% with selected=form.style.value %}
      {% field
        class="flex flex-row!"
        name="style"
        label="Style Preset"
        as="radio"
        value=selected
        error=form.style.errors
        error_message=form.style.errors.as_text
        %}
        <div class="flex flex-row gap-4 flex-wrap">
          {% for key, label in form.fields.style.choices %}
            <label class="bg-dark flex items-center gap-2 p-2 border border-neutral-700 rounded cursor-pointer hover:border-accent transition-all"
                   :class="{ 'ring-1 ring-accent': form.style === '{{ key }}' }">
              <input type="radio"
                     name="style"
                     x-model="form.style"
                     value="{{ key }}"
                     {% if selected == key %}
                       checked
                     {% endif %}
                     class="accent-accent w-5 h-5 border border-neutral-700" />
              <span class="text-sm text-primary">{{ label }}</span>
            </label>
          {% endfor %}
        </div>
      {% endfield %}
    {% endwith %}

    <div class="max-w-xs">
      {% with selected=form.radius.value %}
        {% field
          name="radius"
          label="Card Shape"
          as="select"
          value=selected
          error=form.radius.errors
          error_message=form.radius.errors.as_text
          x_model="form.radius" %}
          {% for key, label in form.fields.radius.choices %}
            <option value="{{ key }}" {% if selected == key %}selected{% endif %}>
              {{ label }}
            </option>
          {% endfor %}
        {% endfield %}
      {% endwith %}
    </div>
  </div>
</form>
