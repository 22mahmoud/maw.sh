{% load field_tags %}

<form id="guestbook-form"
      method="post"
      action="{% url 'guestbook' %}"
      hx-post="{% url 'guestbook' %}"
      hx-target="#guestbook-form"
      hx-swap="outerHTML">
  <div class="space-y-4">
    <noscript>
      {% csrf_token %}
      <input type="hidden" name="page_id" value="{{ page.id }}">
      <input type="hidden" name="source_url_fragment" value="#guestbook-form">
    </noscript>

    <div class="grid grid-cols-3 gap-4 items-stretch">
      <div class="col-span-2">
        {% field
          required="required"
          name="name"
          label="Name"
          value=form.name.value
          error=form.name.errors
          error_message=form.name.errors.as_text
          :value="form.name"
          @input="updateFormField"
          %}
        {% endfield %}
      </div>

      {% field
        required="required"
        name="emoji"
        label="Emoji"
        maxlength=2
        value=form.emoji.value
        error=form.emoji.errors
        error_message=form.emoji.errors.as_text
        :value="form.emoji"
        @input="updateFormField"
        %}
      {% endfield %}
    </div>

    {% with selected=form.style.value %}
      {% field
        class="flex flex-row!"
        name="style"
        label="Style Preset"
        as="radio"
        value=selected
        error=form.style.errors
        error_message=form.style.errors.as_text
        %}
        <div class="flex flex-row gap-4 flex-wrap">
          {% for key, label in form.fields.style.choices %}
            <label data-key="{{ key }}"
                   class="bg-dark flex items-center gap-2 p-2 border border-neutral-700 rounded cursor-pointer hover:border-accent transition-all"
                   :class="presetSelectorClass">
              <input type="radio"
                     name="style"
                     value="{{ key }}"
                     {% if selected == key %}
                       checked
                     {% endif %}
                     :checked="isTargetSelected"
                     @change="updateFormField"
                     class="accent-accent w-5 h-5 border border-neutral-700" />
              <span class="text-sm text-primary">{{ label }}</span>
            </label>
          {% endfor %}
        </div>
      {% endfield %}
    {% endwith %}

    {% field
      required="required"
      maxlength="280"
      name="message"
      label="Message"
      as="textarea"
      rows=4
      value=form.message.value
      error=form.message.errors
      error_message=form.message.errors.as_text
      help_text="Supports basic Markdown and HTML. Max 280 characters. GIFs allowed from giphy/tenor/imgur."
      :value="form.message"
      @input="updateFormField"
      %}
    {% endfield %}

    {% field
      name="url"
      label="Website (optional)"
      value=form.url.value
      error=form.url.errors
      error_message=form.url.errors.as_text
      :value="form.url"
      @input="updateFormField"
      %}
    {% endfield %}

    <div class="max-w-xs">
      {% with selected=form.radius.value %}
        {% field
          name="radius"
          label="Card Shape"
          as="select"
          value=selected
          error=form.radius.errors
          error_message=form.radius.errors.as_text
          @change="updateFormField"
          %}
          {% for key, label in form.fields.radius.choices %}
            <option data-name="radius"
                    value="{{ key }}"
                    {% if selected == key %}
                      selected
                    {% endif %}
                    :selected="isTargetSelected">
              {{ label }}
            </option>
          {% endfor %}
        {% endfield %}
      {% endwith %}
    </div>
  </div>
</form>
