{# djlint:off D018 #}
{% extends "base.html" %}
{% load link_tags wagtailcore_tags wagtailimages_tags wagtailroutablepage_tags %}

{% block content %}
  <div class="grow flex zigzag bg-dark pt-6">
    <article class="grow flex flex-col h-entry mx-auto max-w-3xl gap-6 py-4 px-4 sm:px-6">
      {% include "includes/breadcrumb.html" with page=self %}

      <header class="px-4 bg-darker flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 text-sm py-4 border-b border-primary/20">
        <div class="flex items-center flex-wrap gap-3 sm:gap-4 flex-1 min-w-0">
          {% for author in page.authors %}
            <a href="{% routablepageurl page.get_site.root_page.specific 'posts_by_author' author.slug %}"
               class="h-card flex items-center gap-3 transition-all duration-200 hover:scale-[1.02] group">
              <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full overflow-hidden flex-shrink-0 ring-2 ring-transparent group-hover:ring-accent/30 transition-all duration-200">
                {% picture author.image format-{avif,webp,jpeg} width-200 alt=author.full_name class="u-photo w-full h-full object-cover" %}
              </div>
              <div class="flex flex-col min-w-0 flex-1">
                <span class="p-name font-medium text-primary group-hover:text-accent transition-colors duration-200 truncate">
                  {{ author.full_name }}
                </span>
                {% if author.title %}
                  <span class="text-xs text-primary/80 truncate">{{ author.title }}</span>
                {% endif %}
                {% if author.bio %}
                  <span class="text-xs text-secondary truncate hidden sm:block"
                        title="{{ author.bio }}">
                    {{ author.bio|truncatewords:5 }}
                  </span>
                {% endif %}
              </div>
            </a>
          {% endfor %}
        </div>

        <div class="flex flex-col items-start sm:items-end text-left sm:text-right flex-shrink-0">
          <time class="dt-published font-medium text-primary text-sm sm:text-base"
                datetime="{{ page.first_published_at|date:'c' }}">
            <span class="hidden sm:inline">{{ page.first_published_at|date:"F j, Y" }}</span>
            <span class="sm:hidden">{{ page.first_published_at|date:"M j, Y" }}</span>
          </time>
          <span class="text-xs text-primary/70">
            {{ page.first_published_at|date:"g:i A" }}
          </span>
          {% if page.last_published_at != page.first_published_at %}
            <span class="text-xs text-primary/60 mt-1">
              <span class="hidden sm:inline">Updated</span>
              <span class="sm:hidden">Upd.</span>
              {{ page.last_published_at|date:"M j, Y" }}
            </span>
          {% endif %}
          {% if page.get_tags %}
            <div class="flex items-center flex-wrap gap-2 mt-2 sm:justify-end">
              <ul class="flex flex-wrap gap-2">
                {% for tag in page.get_tags %}
                  <li>
                    {% link href=tag.url variant="tag" %}
                      #{{ tag }}
                    {% endlink %}
                  </li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
        </div>
      </header>

      <main class="flex-1">
        {% if page.body.0.block_type == 'article' %}
          <div class="mb-6 prose prose-main text-center space-y-3 sm:space-y-4">
            <h1 class="p-name text-balance font-heading">
              {{ page.title }}
            </h1>
            {% if page.subtitle %}
              <p class="text-base sm:text-lg md:text-xl text-secondary/90 leading-relaxed max-w-4xl mx-auto">
                {{ page.subtitle }}
              </p>
            {% endif %}
          </div>
        {% endif %}

        {% if page.body %}
          {% for block in page.body %}
            {% include_block block with layout="default" %}
          {% endfor %}
        {% endif %}

        {% if page.webmentions %}
          <div class="mt-16 pt-8 border-t border-primary/20 space-y-10">
            <h2 class="text-2xl sm:text-3xl font-heading text-primary">
              Webmentions
            </h2>

            {% if page.webmentions.likes %}
              <div class="space-y-4">
                <h3 class="text-lg font-medium text-primary">
                  Likes <span class="text-base text-secondary font-normal">({{ page.webmentions.likes|length }})</span>
                </h3>
                <div class="flex flex-wrap gap-2">
                  {% for mention in page.webmentions.likes %}
                    <a href="{{ mention.author.url }}"
                       title="{{ mention.author.name }}"
                       class="group block w-10 h-10 rounded-full overflow-hidden transition-all duration-200 hover:scale-110">
                      <div class="w-full h-full ring-2 ring-transparent group-hover:ring-accent/70 rounded-full transition-all duration-200">
                        {% if mention.author.photo %}
                          {% picture mention.author.photo width-40 lading="lazy" class="w-full h-full object-cover" %}
                        {% else %}
                          <div class="flex items-center justify-center w-full h-full bg-neutral-700 text-primary font-bold text-lg">
                            ?
                          </div>
                        {% endif %}
                      </div>
                    </a>
                  {% endfor %}
                </div>
              </div>
            {% endif %}

            {% if page.webmentions.reposts %}
              <div class="space-y-4">
                <h3 class="text-lg font-medium text-primary">
                  Reposts <span class="text-base text-secondary font-normal">({{ page.webmentions.reposts|length }})</span>
                </h3>
                <div class="flex flex-wrap gap-2">
                  {% for mention in page.webmentions.reposts %}
                    <a href="{{ mention.author.url }}"
                       title="{{ mention.author.name }}"
                       class="group block w-10 h-10 rounded-full overflow-hidden transition-all duration-200 hover:scale-110">
                      <div class="w-full h-full ring-2 ring-transparent group-hover:ring-accent/70 rounded-full transition-all duration-200">
                        {% if mention.author.photo %}
                          {% picture mention.author.photo width-40 lading="lazy" class="w-full h-full object-cover" %}
                        {% else %}
                          <div class="flex items-center justify-center w-full h-full bg-neutral-700 text-primary font-bold text-lg">
                            ?
                          </div>
                        {% endif %}
                      </div>
                    </a>
                  {% endfor %}
                </div>
              </div>
            {% endif %}

            {% if page.webmentions.bookmarks %}
              <div class="space-y-4">
                <h3 class="text-lg font-medium text-primary">
                  Bookmarks <span class="text-base text-secondary font-normal">({{ page.webmentions.bookmarks|length }})</span>
                </h3>
                <div class="flex flex-wrap gap-2">
                  {% for mention in page.webmentions.bookmarks %}
                    <a href="{{ mention.author.url }}"
                       title="{{ mention.author.name }}"
                       class="group block w-10 h-10 rounded-full overflow-hidden transition-all duration-200 hover:scale-110">
                      <div class="w-full h-full ring-2 ring-transparent group-hover:ring-accent/70 rounded-full transition-all duration-200">
                        {% if mention.author.photo %}
                          {% picture mention.author.photo width-40 lading="lazy" class="w-full h-full object-cover" %}
                        {% else %}
                          <div class="flex items-center justify-center w-full h-full bg-neutral-700 text-primary font-bold text-lg">
                            ?
                          </div>
                        {% endif %}
                      </div>
                    </a>
                  {% endfor %}
                </div>
              </div>
            {% endif %}

            {% if page.webmentions.replies %}
              <div class="space-y-4">
                <h3 class="text-lg font-medium text-primary">
                  Replies <span class="text-base text-secondary font-normal">({{ page.webmentions.replies|length }})</span>
                </h3>
                <div class="flex flex-col gap-6">
                  {% for mention in page.webmentions.replies %}
                    <div class="flex gap-3 sm:gap-4">
                      <div class="flex-shrink-0">
                        <a href="{{ mention.author.url }}"
                           class="group block w-10 h-10 rounded-full overflow-hidden">
                          <div class="w-full h-full rounded-full ring-2 ring-transparent group-hover:ring-accent/70 transition-all duration-200">
                            {% if mention.author.photo %}
                              {% picture mention.author.photo width-40 lading="lazy" class="w-full h-full object-cover" %}
                            {% else %}
                              <div class="flex items-center justify-center w-full h-full bg-neutral-700 text-primary font-bold text-lg">
                                ?
                              </div>
                            {% endif %}
                          </div>
                        </a>
                      </div>
                      <div class="flex-1 bg-darker p-3 sm:p-4 rounded-lg border border-primary/10">
                        <div class="flex justify-between items-center text-sm mb-2">
                          <a href="{{ mention.author.url }}"
                             class="font-medium text-primary hover:text-accent transition-colors duration-200">
                            {{ mention.author.name }}
                          </a>
                          <a href="{{ mention.url }}"
                             class="text-xs text-secondary hover:underline"
                             title="View original reply">
                            <time datetime="{{ mention.published|date:'c' }}">{{ mention.published|date:"M j, Y" }}</time>
                          </a>
                        </div>
                        <div class="prose prose-main prose-sm max-w-none text-primary/90">
                          {{ mention.content_html|safe }}
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                </div>

              </div>
            {% endif %}
          </div>
        {% endif %}
      </main>

      <footer class="bg-darker [&_a]:border-1! [&_a]:w-fit mt-8 border-t border-primary/20 p-4">
        {% include "includes/pagination.html" with prev_url=page.prev_sibling.url prev_title=page.prev_sibling.title|truncatewords:5 next_url=page.next_sibling.url next_title=page.next_sibling.title|truncatewords:5 %}
      </footer>
    </article>
  </div>
{% endblock content %}
