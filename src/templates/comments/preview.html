{% extends "base.html" %}
{% load i18n wagtailimages_tags %}
{% load comments_xtd %}

{% block title %}
  {% trans "Preview your comment" %}
{% endblock title %}

{% block content %}
  <div class="grow flex zigzag bg-dark pt-6">
    <article class="grow flex flex-col mx-auto max-w-3xl gap-6 py-4 px-4 sm:px-6">
      <header class="mb-6 prose text-center space-y-2">
        <h1 class="text-xl font-semibold text-primary">
          {% trans "Preview your comment for:" %}
        </h1>
        <p>
          <a href="{{ form.target_object.get_absolute_url }}"
             class="text-accent hover:underline">
            {{ form.target_object }}
          </a>
        </p>
      </header>

      <section id="comment-preview" hx-swap-oob="true" class="flex gap-3 sm:gap-4">
        <div class="flex-1 flex gap-4">
          <div class="flex-shrink-0">
            <div class="w-10 ht-10 rounded-full overflow-hidden ring-2 ring-transparent group-hover:ring-accent transition-all duration-200">
              {% with user=request.user %}
                {% if user.avatar %}
                  {% picture user.avatar format-{avif,webp,jpeg} width-40 class="w-10 ht-10 rounded-full object-cover" alt=user_name %}
                {% else %}
                  <img src="{{ form.cleaned_data.email|xtd_comment_gravatar_url }}"
                       alt="{{ form.cleaned_data.name }}’s avatar"
                       class="w-10 ht-10 rounded-full object-cover"
                       width="40"
                       height="40"
                       loading="lazy">
                {% endif %}
              {% endwith %}
            </div>
          </div>

          <div class="flex-1 rounded-xl bg-darker/90 p-4">
            <div class="flex justify-between items-center text-sm mb-2">
              <span class="font-medium text-primary">
                {% if form.cleaned_data.url %}
                  <a href="{{ form.cleaned_data.url }}"
                     target="_blank"
                     class="hover:text-accent transition-colors duration-200">
                    {{ form.cleaned_data.name }}
                  </a>
                {% else %}
                  <span>
                    {{ form.cleaned_data.name }}
                  </span>
                {% endif %}
              </span>
              <time datetime="{% now "c" %}" class="text-xs text-secondary/80">
                {% now "M j, Y · H:i" %}
              </time>
            </div>

            <div class="prose max-w-none text-primary/90 mb-3 leading-relaxed">
              {% if not comment %}
                <em class="text-secondary italic">{% trans "This comment is Empty." %}</em>
              {% else %}
                {{ comment|linebreaks }}
              {% endif %}
            </div>
          </div>
        </div>
      </section>

      <section class="p-6">
        <h2 class="text-lg font-semibold text-primary text-center mb-4">
          {% trans "Post your comment" %}
        </h2>
        {% include "comments/form.html" %}
      </section>
    </article>
  </div>
{% endblock content %}
