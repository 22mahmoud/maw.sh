{% load i18n %}
{% load comments button_tags base_tags %}

<form hx-swap-oob="true"
      method="post"
      id="comment-form"
      hx-post="{% comment_form_target %}"
      action="{% comment_form_target %}"
      class="space-y-6 mx-auto">

  {% csrf_token %}

  <input type="hidden" name="next" value="{% url 'comments-xtd-sent' %}" />

  {% for hidden in form.hidden_fields %}
    {{ hidden }}
  {% endfor %}

  <div class="sr-only">
    {{ form.honeypot }}
  </div>

  {% if form.reply_to and form.reply_to.value and form.reply_to.value != "0" %}
    <div class="js-only flex items-center pt-6 gap-4 text-sm text-primary"
         role="note">
      <span class="italic">
        Replying to comment #{{ form.reply_to.value }}
      </span>
      {% comment_form_target as comment_post_url %}
      <a type="button"
         hx-get="{{ comment_get_url }}"
         class="text-accent hover:underline">
        Cancel
      </a>
    </div>
  {% endif %}

  {% if not request.user.is_authenticated or not request.user.get_full_name %}
    <div class="flex flex-col gap-1.5 group">
      {{ form.name.as_field_group }}
    </div>
  {% endif %}

  {% if not request.user.is_authenticated or not request.user.email %}
    <div class="flex flex-col gap-1.5 group">
      {{ form.email.as_field_group }}
    </div>
  {% endif %}

  {% if not request.user.is_authenticated %}
    <div class="flex flex-col gap-1.5 group">
      {{ form.url.as_field_group }}
    </div>
  {% endif %}

  <div class="flex flex-col gap-1.5 group">
    {{ form.comment.as_field_group }}
  </div>

  <div class="flex flex-col gap-1.5 group">
    {{ form.followup.as_field_group }}
  </div>

  <div class="flex flex-row items-center gap-6">
    {% button
      type="submit"
      size="md"
      class="w-fit rounded-none"
      name="send"
      id="comment-submit-button"
      %}
      Submit
    {% endbutton %}

    {% button
      type="submit"
      variant="outline"
      size="md"
      class="w-fit rounded-none"
      name="preview"
      id="comment-preview-button"
      value="Preview"
      %}
      Preview
    {% endbutton %}

    <div class="flex justify-end flex-1">
      <div role="status" aria-live="polite" class="flex justify-end flex-1">
        {% icon 'circle-notch' id="spinner" class="htmx-indicator animate-spin ht-8 w-8" %}
        <span class="sr-only">Submitting your commentâ€¦</span>
      </div>
    </div>
  </div>
</form>
