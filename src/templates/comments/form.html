{% load i18n %}
{% load comments button_tags field_tags base_tags %}

<form hx-swap-oob="true"
      method="post"
      id="comment-form"
      hx-post="{% comment_form_target %}"
      action="{% comment_form_target %}"
      class="space-y-6 mx-auto">

  {% csrf_token %}

  <input type="hidden" name="next" value="{% url 'comments-xtd-sent' %}" />

  {% for hidden in form.hidden_fields %}
    {{ hidden }}
  {% endfor %}

  <div hidden>
    {{ form.honeypot }}
  </div>

  {% if form.reply_to and form.reply_to.value and form.reply_to.value != "0" %}
    <div class="js-only flex items-center pt-6 gap-4 text-sm text-primary">
      <span class="italic">
        Replying to comment #{{ form.reply_to.value }}
      </span>
      {% comment_form_target as comment_post_url %}
      <a type="button"
         hx-get="{{ comment_get_url }}"
         class="text-accent hover:underline">
        Cancel
      </a>
    </div>
  {% endif %}

  {% if not request.user.is_authenticated or not request.user.get_full_name %}
    {% field
      required=""
      name="name"
      label=form.name.label
      value=form.name.value
      error=form.name.errors
      error_message=form.name.errors.0
      help_text=form.name.help_text
      id=form.name.id_for_label
      %}
    {% endfield %}
  {% endif %}

  {% if not request.user.is_authenticated or not request.user.email %}
    {% field
      required=""
      name="email"
      label=form.email.label
      value=form.email.value
      error=form.email.errors
      error_message=form.email.errors.0
      help_text=form.email.help_text
      id=form.email.id_for_label
      %}
    {% endfield %}
  {% endif %}

  {% if not request.user.is_authenticated %}
    {% field
      name="url"
      label=form.url.label
      value=form.url.value
      error=form.url.errors
      error_message=form.url.errors.0
      help_text=form.url.help_text
      id=form.url.id_for_label
      %}
    {% endfield %}
  {% endif %}

  {% field
    required=""
    name="comment"
    label=form.comment.label
    value=form.comment.value
    error=form.comment.errors
    error_message=form.comment.errors.0
    help_text=form.comment.help_text
    as="textarea"
    rows=4
    id=form.comment.id_for_label
    %}
  {% endfield %}

  {% field
    name="followup"
    label=form.followup.label
    value=form.followup.value
    error=form.followup.errors
    error_message=form.followup.errors.0
    id=form.followup.id_for_label
    as="checkbox"
    %}
  {% endfield %}

  <div class="flex flex-row items-center gap-6">
    {% button
      size="md"
      as="input"
      class="w-fit rounded-none"
      name="send"
      id="comment-submit-button"
      value="Submit"
      %}
    {% endbutton %}

    {% button
      variant="outline"
      size="md"
      as="input"
      class="w-fit rounded-none"
      name="preview"
      id="comment-preview-button"
      value="Preview"
      %}
    {% endbutton %}

    <div class="flex justify-end flex-1">
      {% icon 'circle-notch' id="spinner" class="htmx-indicator animate-spin h-8 w-8" %}
    </div>
  </div>
</form>
