{% extends "base.html" %}
{% load i18n %}
{% load base_tags partials field_tags button_tags link_tags %}

{% block title %}
  {% trans "Profile | Mahmoud Ashraf" %}
{% endblock title %}

{% block content %}
  <section class="grow-1 w-full bg-dark px-4 py-10 sm:py-14 md:py-20 zigzag">
    <div class="bg-darker max-w-xl mx-auto bg-card px-6 py-8 sm:px-10 sm:py-12 text-primary grid gap-10">

      <header class="grid gap-2 text-center sm:text-left">
        <h1 class="text-3xl font-bold">
          {% trans "Your Profile" %}
        </h1>
        <p class="text-secondary text-sm">
          {% trans "Manage your personal information, login credentials, and connected accounts." %}
        </p>
      </header>

      <section aria-labelledby="account-info" class="grid gap-6">
        <h2 id="account-info" class="text-xl font-semibold">
          {% trans "Account Information" %}
        </h2>

        <dl class="grid gap-4 text-sm sm:text-base">
          <div class="grid gap-1 sm:grid-cols-2 sm:items-center">
            <dt class="font-medium">
              {% trans "Username" %}
            </dt>
            <dd class="sm:text-right text-muted break-words">
              {{ request.user.username }}
            </dd>
          </div>

          <div class="grid gap-1 sm:grid-cols-2 sm:items-center">
            <dt class="flex flex-col font-medium">
              {% trans "Email" %}
              {% url 'account_email' as email_url %}
              {% link href=email_url class="text-accent text-sm hover:underline" %}
                {% trans "Manage email addresses" %}
              {% endlink %}
            </dt>
            <dd class="sm:text-right text-muted break-words">
              {{ request.user.email }}
            </dd>
          </div>

          <div class="grid gap-1 sm:grid-cols-2 sm:items-center">
            <dt class="font-medium">
              {% trans "Password" %}
            </dt>
            <dd class="sm:text-right">
              {% url 'account_change_password' as change_password_url %}
              {% link href=change_password_url class="text-accent hover:underline" %}
                {% trans "Change Password" %}
              {% endlink %}
            </dd>
          </div>

          <div class="grid gap-1 sm:grid-cols-2 sm:items-center">
            <dt class="font-medium">
              {% trans "Connections" %}
            </dt>
            <dd class="sm:text-right">
              {% url 'socialaccount_connections' as conn_url %}
              {% link href=conn_url class="text-accent hover:underline" %}
                {% trans "Manage Account Connections" %}
              {% endlink %}
            </dd>
          </div>
        </dl>
      </section>

      <section aria-labelledby="update-profile" class="grid gap-4">
        <h2 id="update-profile" class="text-xl font-semibold">
          {% trans "Update Your Profile" %}
        </h2>

        {% partialdef profile-form inline %}
          <form method="post"
                action="{% url 'account_profile' %}"
                enctype='multipart/form-data'
                hx-post="{% url 'account_profile' %}"
                hx-encoding='multipart/form-data'
                hx-swap="outerHTML"
                class="grid gap-4"
                id="profile-form">
            {% csrf_token %}

            <div class="grid sm:grid-cols-2 gap-4 items-start">
              {{ form }}
            </div>

            {% button type="submit" variant="outline" class="w-fit ms-auto" %}
              {% trans "Save Changes" %}
              {% icon 'circle-notch' id="spinner" class="ms-2 htmx-indicator animate-spin h-3 w-3" %}
            {% endbutton %}
          </form>
        {% endpartialdef %}
      </section>

      <footer class="pt-6 border-t border-muted text-right">
        <form method="post" action="{% url 'account_logout' %}">
          {% csrf_token %}
          {% button type="submit" variant="secondary" %}
            {% trans "Log out" %}
          {% endbutton %}
        </form>
      </footer>
    </div>
  </section>
{% endblock content %}
