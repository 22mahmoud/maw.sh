{% extends "base.html" %}
{% load i18n base_tags allauth account button_tags %}

{% block title %}
  {% if token_fail %}
    {% trans "Bad Token | Mahmoud Ashraf" %}
  {% else %}
    {% trans "Change Password | Mahmoud Ashraf" %}
  {% endif %}
{% endblock title %}

{% block content %}
  <section class="grow-1 w-full bg-dark px-4 py-10 sm:py-14 md:py-20 zigzag">
    <div class="bg-darker max-w-xl mx-auto bg-card px-6 py-8 sm:px-10 sm:py-12 text-primary grid gap-10">

      <header class="grid gap-2 text-center sm:text-left">
        <h2 class="text-3xl font-bold">
          {% if token_fail %}
            {% trans "Bad Token" %}
          {% else %}
            {% trans "Change Password" %}
          {% endif %}
        </h2>
      </header>

      {% if token_fail %}
        {% url 'account_reset_password' as passwd_reset_url %}
        <p class="text-primary/80">
          {% blocktrans %}
            The password reset link was invalid, possibly because it has already been used.
            Please request a
            <a href="{{ passwd_reset_url }}" class="text-accent underline hover:text-accent-bright">
              new password reset
            </a>.
          {% endblocktrans %}
        </p>
      {% else %}
        <form id="password-reset-form"
              method="post"
              action="{{ action_url }}"
              class="flex flex-col gap-5"
              hx-post="{{ action_url }}"
              hx-select="#password-reset-form, #password-changed"
              hx-swap="outerHTML">
          {% csrf_token %}
          {{ redirect_field }}

          {{ form }}

          <div class="flex items-center justify-between gap-6">
            {% button type="submit" name="action" variant="primary" %}
              {% trans "Change Password" %}
              {% icon 'circle-notch' id="spinner" class="htmx-indicator animate-spin h-5 w-5" %}
            {% endbutton %}

            <button type="submit"
                    form="logout-from-stage"
                    class="text-primary/70 underline hover:text-primary transition">
              {% translate "Cancel" %}
            </button>
          </div>
        </form>
      {% endif %}

      {% if not cancel_url %}
        <form id="logout-from-stage"
              method="post"
              action="{% url 'account_logout' %}">
          <input type="hidden" name="next" value="{% url 'account_login' %}">
          {% csrf_token %}
        </form>
      {% endif %}
    </div>
  </section>
{% endblock content %}
