{% extends "base.html" %}
{% load i18n allauth account field_tags button_tags %}

{% block title %}
  {% if token_fail %}
    {% trans "Bad Token | Mahmoud Ashraf" %}
  {% else %}
    {% trans "Change Password | Mahmoud Ashraf" %}
  {% endif %}
{% endblock title %}

{% block content %}
  <div class="flex-1 w-full bg-dark px-4 py-8 sm:py-12 md:py-16 zigzag">
    <div class="max-w-xl mx-auto px-6 py-8 sm:px-8 sm:py-10 space-y-6 text-primary">
      <h2 class="text-2xl font-semibold">
        {% if token_fail %}
          {% trans "Bad Token" %}
        {% else %}
          {% trans "Change Password" %}
        {% endif %}
      </h2>

      {% if token_fail %}
        {% url 'account_reset_password' as passwd_reset_url %}
        <p class="text-primary/80">
          {% blocktrans %}
            The password reset link was invalid, possibly because it has already been used.
            Please request a
            <a href="{{ passwd_reset_url }}" class="text-accent underline hover:text-accent-bright">
              new password reset
            </a>.
          {% endblocktrans %}
        </p>
      {% else %}
        <form id="password-reset-form"
              method="post"
              action="{{ action_url }}"
              class="flex flex-col gap-5"
              hx-post="{{ action_url }}"
              hx-select="#password-reset-form, #password-changed"
              hx-swap="outerHTML">
          {% csrf_token %}
          {{ redirect_field }}

          {% for field in form %}
            {% field
              type=field.field.widget.input_type
              name=field.name
              id=field.id_for_label
              label=field.label
              value=field.value
              help_text=field.help_text
              required=field.field.required
              error=field.errors
              error_message=field.errors.as_text
              %}
            {% endfield %}
          {% endfor %}

          <div class="flex items-center justify-between gap-6">
            {% button type="submit" name="action" variant="primary" %}
              {% trans "Change Password" %}
            {% endbutton %}

            <button type="submit"
                    form="logout-from-stage"
                    class="text-primary/70 underline hover:text-primary transition">
              {% translate "Cancel" %}
            </button>
          </div>
        </form>
      {% endif %}

      {% if not cancel_url %}
        <form id="logout-from-stage"
              method="post"
              action="{% url 'account_logout' %}">
          <input type="hidden" name="next" value="{% url 'account_login' %}">
          {% csrf_token %}
        </form>
      {% endif %}
    </div>
  </div>
{% endblock content %}
