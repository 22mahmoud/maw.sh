#!/bin/bash
set -e

MAGICK_BINARY_PATH=$(readlink -f "$(command -v magick || exit 1)")
MAGICK_HOME=$(dirname "$(dirname "$MAGICK_BINARY_PATH")")

export MAGICK_HOME

echo "Found ImageMagick binary at: $MAGICK_BINARY_PATH"
echo "MAGICK_HOME set to: $MAGICK_HOME"
echo "Starting application..."

gunicorn config.wsgi \
  --workers 5 \
  --bind 0.0.0.0:8000 \
  --worker-class sync \
  --timeout 60 \
  --access-logfile - \
  --error-logfile - \
  --log-level info \
  --max-requests 1000 \
  --log-config-json logconfig.json \
  --max-requests-jitter 100
